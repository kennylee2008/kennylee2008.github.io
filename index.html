<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF10ZDZP2S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KF10ZDZP2S');
</script>
<!-- End Google Analytics -->

  
  <title>Future Labs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Future Labs">
<meta property="og:url" content="https://www.futlabs.com/index.html">
<meta property="og:site_name" content="Future Labs">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kenny Lee">
<meta property="article:tag" content="fullstack java developer git github future labs playground technology">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Future Labs" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/css/images/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Future Labs</a>
      </h1>
      
      <h2 id="subtitle-wrap">
        <a href="/" id="subtitle"
          >A Playground for Fullstack Technologies</a
        >
      </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
        <a class="main-nav-link" href="/"
          >Home</a
        >
        
        <a class="main-nav-link" href="/archives"
          >Archives</a
        >
        
      </nav>
      <nav id="sub-nav">
        <a
          id="nav-github-link"
          class="nav-icon"
          href="https://github.com/kennylee2008"
          title="github"
          target="_blank"
        ></a>
        <!-- <a id="nav-linkedin-link" class="nav-icon" href="" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="" target="_blank"></a>
        <a id="nav-googleplus-link" class="nav-icon" href="" target="_blank"></a> -->
        
        <a
          id="nav-rss-link"
          class="nav-icon"
          href="/atom.xml"
          title="RSS Feed"
        ></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.futlabs.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-How-to-Integrate-Github-and-Jenkins-Part-II" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/" class="article-date">
  <time class="dt-published" datetime="2021-08-11T12:53:45.000Z" itemprop="datePublished">2021-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/">How to Integrate Github and Jenkins - Part II</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>This article is the second part of a series on integrating Jenkins and Github. It focuses on how to use the <em>git diff</em> command in Jenkinsfile to get the differences between the Repository’s current Commit and the last Commit, and use the <strong>SSH Agent</strong> to connect to a remote host to execute commands and upload files via <em>scp</em>.</p>
<h2 id="How-to-get-the-difference-between-two-commits"><a href="#How-to-get-the-difference-between-two-commits" class="headerlink" title="How to get the difference between two commits?"></a>How to get the difference between two commits?</h2><p>The <em>git diff</em> command can be used to get the difference between two commits. For example.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git diff --name-only --diff-filter=D &lt;COMMIT_ID_1&gt; &lt;COMMIT_ID_2&gt;</span><br></pre></td></tr></table></figure>

<p>We need to know which files were deleted and which files were updated or added between commits. <em>git diff</em> has a very rich set of parameters to use, so here are just a few of the ones we might want to use.</p>
<p><strong>–name-only</strong>, this parameter is used to output the name of file only.Because we need to know the filename and the path,so we will use this parameter later.</p>
<p><strong>–diff-filter</strong>, this parameter is used to query for the files we need. For example, <em>–diff-filter=D</em>, meaning deleted files. <em>–diff-filter=A</em> means the file that was added. And if lowercase letters are used, it means exclude. For example <em>–diff-filter=d</em>, means all files except those deleted files.</p>
<p>We can start by running <em>git log</em> to get a list of the commit history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">% git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">commit 882866463421d32f9920f7675fa1c3e51caaa1ba (HEAD -&gt; main, origin/main)</span><br><span class="line">Author: kennylee2008 &lt;tengfei.lee@qq.com&gt;</span><br><span class="line">Date:   Wed Aug 11 16:33:24 2021 +1200</span><br><span class="line"></span><br><span class="line">    modify the color of the menus</span><br><span class="line"></span><br><span class="line">commit 381d6a602ef1ae5181a72785a91495ebec347e61</span><br><span class="line">Merge: 4c87bb0 13ec5c1</span><br><span class="line">Author: kennylee2008 &lt;tengfei.lee@qq.com&gt;</span><br><span class="line">Date:   Wed Aug 11 16:32:04 2021 +1200</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>What files were removed from the latest commit compared to the previous commit?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git diff --name-only --diff-filter=D 381d6a602ef1ae5181a72785a91495ebec347e61 882866463421d32f9920f7675fa1c3e51caaa1ba</span><br></pre></td></tr></table></figure>

<p>What files have been added or updated in the latest commit compared to the previous commit?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git diff --name-only --diff-filter=d 381d6a602ef1ae5181a72785a91495ebec347e61 882866463421d32f9920f7675fa1c3e51caaa1ba</span><br></pre></td></tr></table></figure>

<h2 id="How-to-call-Git-commands-in-Jenkinsfile"><a href="#How-to-call-Git-commands-in-Jenkinsfile" class="headerlink" title="How to call Git commands in Jenkinsfile"></a>How to call Git commands in Jenkinsfile</h2><p>You can use <strong>Shell Script</strong> to invoke the <em>git diff</em> command and assign the output to the appropriate variables.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">script&#123;</span><br><span class="line">    <span class="comment">//All modified and added files (none-deleted files)</span></span><br><span class="line">    COMMIT_CHANGES = sh (</span><br><span class="line">        returnStdout: <span class="keyword">true</span>,</span><br><span class="line">        script: <span class="string">&quot;git diff --name-only --diff-filter=d $GIT_PREVIOUS_COMMIT $GIT_COMMIT&quot;</span></span><br><span class="line">    ).trim()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//All deleted files</span></span><br><span class="line">    COMMIT_DELETEDS = sh (</span><br><span class="line">        returnStdout: <span class="keyword">true</span>,</span><br><span class="line">        script: <span class="string">&quot;git diff --name-only --diff-filter=D $GIT_PREVIOUS_COMMIT $GIT_COMMIT&quot;</span></span><br><span class="line">    ).trim()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The COMMIT_CHANGES and COMMIT_DELETEDS, obtained in the above example, are both of type String. The $GIT_PREVIOUS_COMMIT/$GIT_COMMIT in the example are the two variables output by the Git plugin.</p>
<p>Since Jenkinsfile can be written using Groovy syntax, which is very similar to Java, programmers familiar with Java can easily master writing Jenkinsfile. For example, the following file is printed out to be deleted.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Converting strings to arrays</span></span><br><span class="line">COMMIT_DELETED_SET = COMMIT_DELETEDS.split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//print out the files to be deleted one by one</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;COMMIT_DELETED_SET.size(); i++)&#123;</span><br><span class="line">	println(COMMIT_DELETED_SET[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Configure-SSH-Credential"><a href="#Configure-SSH-Credential" class="headerlink" title="Configure SSH Credential"></a>Configure SSH Credential</h2><p>You’ve got the list of difference files. Next, you’ll need to connect to the remote host. To do this, we need to configure SSH in Jenkins first.</p>
<p>Generate a public-private key pair:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% ssh-keygen -t rsa -b 4096 -f <span class="string">&quot;mysshkey&quot;</span></span><br></pre></td></tr></table></figure>

<p>Upload the public key to the target remote deployment host:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% ssh-copy-id -i mysshkey example@x.x.x.x</span><br></pre></td></tr></table></figure>

<p>Configure SSH Credential in Jenkins:</p>
<p><img src="/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/2021-08-12T012517.png"><br><img src="/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/2021-08-12T012943.png"><br>The ID and Description are whatever you want, username is the login name of the remote host, and private key is the file you just generated. Passphrase is the password you entered when you used ssh-keygen to generate the public-private key pair (if you didn’t set a password just now, just leave it blank).</p>
<h2 id="Execute-commands-on-the-remote-host"><a href="#Execute-commands-on-the-remote-host" class="headerlink" title="Execute commands on the remote host"></a>Execute commands on the remote host</h2><p>You need to make sure that the <strong>SSH Agent</strong> Plugin is installed.</p>
<p>Example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sshagent(credentials: [<span class="string">&#x27;SSH_Credential_ID_You_Just_Created&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">	sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">		ssh example@x.x.x.x &lt;&lt;EOF</span></span><br><span class="line"><span class="string">		cd /var/www/mywebsite</span></span><br><span class="line"><span class="string">		rm need/to/be/deleted/file</span></span><br><span class="line"><span class="string">		exit</span></span><br><span class="line"><span class="string">		EOF</span></span><br><span class="line"><span class="string">	&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Transferring-files-to-a-remote-host"><a href="#Transferring-files-to-a-remote-host" class="headerlink" title="Transferring files to a remote host"></a>Transferring files to a remote host</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sshagent(credentials: [<span class="string">&#x27;SSH_Credential_ID_You_Just_Created&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">	sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">		scp local/file example@x.x.x.x:/remote/file/path</span></span><br><span class="line"><span class="string">	&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="A-simple-Jenkinsfile-sample"><a href="#A-simple-Jenkinsfile-sample" class="headerlink" title="A simple Jenkinsfile sample"></a>A simple Jenkinsfile sample</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Deploy&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script&#123;</span><br><span class="line">                    <span class="comment">//All modified and added files (none-deleted files)</span></span><br><span class="line">                    COMMIT_CHANGES = sh (</span><br><span class="line">                        returnStdout: <span class="keyword">true</span>,</span><br><span class="line">                        script: <span class="string">&quot;git diff --name-only --diff-filter=d $GIT_PREVIOUS_COMMIT $GIT_COMMIT&quot;</span></span><br><span class="line">                    ).trim()</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//All deleted files</span></span><br><span class="line">                    COMMIT_DELETEDS = sh (</span><br><span class="line">                        returnStdout: <span class="keyword">true</span>,</span><br><span class="line">                        script: <span class="string">&quot;git diff --name-only --diff-filter=D $GIT_PREVIOUS_COMMIT $GIT_COMMIT&quot;</span></span><br><span class="line">                    ).trim()</span><br><span class="line">                &#125;</span><br><span class="line">                sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                    [ -d ~/.ssh ] || mkdir ~/.ssh &amp;&amp; chmod 0700 ~/.ssh</span></span><br><span class="line"><span class="string">                    ssh-keyscan -t rsa,dsa x.x.x.x &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">                &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                script&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//Get the changed files set</span></span><br><span class="line">                    COMMIT_CHANGE_SET = COMMIT_CHANGES.split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    COMMIT_DELETED_SET = COMMIT_DELETEDS.split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    sshagent(credentials: [<span class="string">&#x27;SSH_With_PrivateKey_to_Deploy_Machine&#x27;</span>]) &#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;COMMIT_CHANGE_SET.size(); i++)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(!COMMIT_CHANGE_SET[i].startsWith(<span class="string">&quot;directory/need/to/be/deploy&quot;</span>)</span><br><span class="line">                                &amp;&amp; !COMMIT_CHANGE_SET[i].startsWith(<span class="string">&quot;another/directory/need/to/be/deploy&quot;</span>)</span><br><span class="line">                            )&#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            COMMIT_CHANGE_DIR = COMMIT_CHANGE_SET[i].substring(<span class="number">0</span>, COMMIT_CHANGE_SET[i].lastIndexOf(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//force create the directory and upload the file</span></span><br><span class="line">                            sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                                ssh example@x.x.x.x &#x27;mkdir -p /var/www/websites/example/$COMMIT_CHANGE_DIR&#x27;</span></span><br><span class="line"><span class="string">                                scp $&#123;COMMIT_CHANGE_SET[i]&#125; example@x.x.x.x:/var/www/websites/example/$COMMIT_CHANGE_DIR</span></span><br><span class="line"><span class="string">                            &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;COMMIT_DELETED_SET.size(); i++)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(!COMMIT_DELETED_SET[i].startsWith(<span class="string">&quot;directory/need/to/be/deploy&quot;</span>)</span><br><span class="line">                                &amp;&amp; !COMMIT_DELETED_SET[i].startsWith(<span class="string">&quot;another/directory/need/to/be/deploy&quot;</span>)</span><br><span class="line">                            )&#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">//delete the file</span></span><br><span class="line">                            sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                                ssh example@x.x.x.x &lt;&lt;EOF</span></span><br><span class="line"><span class="string">                                cd /var/www/websites/example</span></span><br><span class="line"><span class="string">                                rm $&#123;COMMIT_DELETED_SET[i]&#125;</span></span><br><span class="line"><span class="string">                                exit</span></span><br><span class="line"><span class="string">                                EOF</span></span><br><span class="line"><span class="string">                            &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.futlabs.com/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/" data-id="cks7jeh9f0001y25vcn5gaw41" data-title="How to Integrate Github and Jenkins - Part II" class="article-share-link">Share</a>
      
        <a href="https://www.futlabs.com/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/#disqus_thread" class="article-comment-link">Comments</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkinsfile/" rel="tag">Jenkinsfile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSH-Agent/" rel="tag">SSH Agent</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git-diff/" rel="tag">git diff</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pipeline/" rel="tag">pipeline</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-How-to-Integrate-Github-and-Jenkins-Part-I" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/" class="article-date">
  <time class="dt-published" datetime="2021-08-09T11:37:12.000Z" itemprop="datePublished">2021-08-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/">How to Integrate Github and Jenkins - Part I</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>This series is divided into two parts to introduce how to integrate Github and Jenkins in practice.</p>
<p>The first part focuses on how to trigger the Jenkins pipeline to run when you push to the Github.</p>
<p>The second part focuses on how to write Jenkins pipeline to get the difference between two commits so that you can perform different operations , such as deleting files in the deployment environment for deleted files, and modified and added files are uploaded to the deployment environment via scp.</p>
<p>This article is the first part of a series on how to use Github’s Webhooks to automatically trigger Jenkins to execute a certain Pipeline you define when you push a project to Github.</p>
<p>This article assumes that you are familiar with Git and the basic operations on Github, including how to create a repository and how to push your local repository to Github; you should also have Jenkins installed and accessible via a public IP address or domain name.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T005223.png"></p>
<h1 id="Step-1-Find-the-callback-URL-address-provided-by-Jenkins"><a href="#Step-1-Find-the-callback-URL-address-provided-by-Jenkins" class="headerlink" title="Step 1: Find the callback URL address provided by Jenkins."></a>Step 1: Find the callback URL address provided by Jenkins.</h1><p>If you want Github to notify your Pipeline defined in Jenkins, you need a URL that you can later configure into Github. Assuming your Jenkins can be accessed via this URL: <a target="_blank" rel="noopener" href="https://jenkins.example.com/">https://jenkins.example.com</a>, basically the callback URL address is <a target="_blank" rel="noopener" href="https://jenkins.example.com/github-webhook/">https://jenkins.example.com/github-webhook/</a>. You can find this URL by these following steps.</p>
<ol>
<li>Log in to your Jenkins</li>
<li>Go to <em>Manage Jenkins</em></li>
<li>click <em>Configure System</em></li>
<li>scroll down, find the <em>Github</em> configuration, and click the <em>Advanced…</em> button</li>
</ol>
<p><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T010111.png"></p>
<ol start="5">
<li>select the <em>Specify another hook URL for GitHub configuration</em></li>
</ol>
<p><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T010427.png"></p>
<p>The one shown above is the URL callback address you need. Note that the purpose of checking that checkbox is only to find your URL address, so remember to <strong>uncheck that checkbox</strong> at the end and <strong>don’t need to save the configuration</strong>.</p>
<h1 id="Step-2-Create-an-Organization-on-Github"><a href="#Step-2-Create-an-Organization-on-Github" class="headerlink" title="Step 2: Create an Organization on Github"></a>Step 2: Create an Organization on Github</h1><p>Since Github does not support individual accounts to set up webhooks, you need to create an Organization. Please refer to: <a target="_blank" rel="noopener" href="https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch">https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch</a> article to create an Organization.</p>
<h1 id="Step-3-Create-a-Repository-under-your-Github-Organization"><a href="#Step-3-Create-a-Repository-under-your-Github-Organization" class="headerlink" title="Step 3: Create a Repository under your Github Organization."></a>Step 3: Create a Repository under your Github Organization.</h1><p>It’s exactly the same as how to create a Repository under your personal account, but now you go inside the Organization to create it instead. I won’t go into detail about this step.</p>
<p>In general, it’s more flexible and convenient to use a Jenkinsfile to define a Pipeline. So, add a file named <em>Jenkinsfile</em> under your Repository root(I won’t go into the details of how to define a Pipeline in this article), and later, I’ll create a Multibranch Pipeline in Jenkins that will use this <em>Jenkinsfile</em> file.</p>
<p>An example of Jenkinsfile:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				echo Hello World</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Step-4-Configuring-Webhooks-in-your-Repository"><a href="#Step-4-Configuring-Webhooks-in-your-Repository" class="headerlink" title="Step 4: Configuring Webhooks in your Repository"></a>Step 4: Configuring Webhooks in your Repository</h1><p>Click on settings in your Repository:<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T011429.png"></p>
<p>Click Webhooks:<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T011456.png"></p>
<p>Click Add Webhook:<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T011556.png"></p>
<p>Fill the callback URL as the Payload URL, you can also choose the appropriate Events to Trigger the webhook.</p>
<p>Finally click the <em>Add webhook</em> button to save it.</p>
<h1 id="Step-5-Create-a-Personal-Access-Token-on-Github"><a href="#Step-5-Create-a-Personal-Access-Token-on-Github" class="headerlink" title="Step 5: Create a Personal Access Token on Github"></a>Step 5: Create a Personal Access Token on Github</h1><p>This is a preparation for being able to access Github later in Jenkins.</p>
<p>Click your account’s Settings(<strong>Not the repository’s Settings</strong>):<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012055.png"></p>
<p>Find the <em>Developer Setting</em> menu on the left:<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012155.png"></p>
<p>Once you are on the page, find <em>Personal access tokens</em>, create a Personal access tokens as required and copy and save it in time, we will use it later.<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012301.png"></p>
<h1 id="Step-6-Create-a-Credential-in-Jenkins"><a href="#Step-6-Create-a-Credential-in-Jenkins" class="headerlink" title="Step 6: Create a Credential in Jenkins"></a>Step 6: Create a Credential in Jenkins</h1><p>In order to enable Jenkins to access Github and download the Repository later, we need to configure a Credential first.</p>
<p>Go to: <em>Manage Jenkins</em> -&gt; <em>Manage Credential</em></p>
<p>Click on <em>Jenkins</em> (below)<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012445.png"></p>
<p>Click <em>Global Credentials</em><br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012521.png"></p>
<p>In the left menu click <em>Add Credentials</em><br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012559.png"></p>
<p>Select <em>Username with password</em> Type<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012644.png"></p>
<p>In the form above, fill in <em>Username</em> with the login email you used for your Github account, <em>Password</em> with the <strong>Personal access token you got in step 5</strong>, and ID with the name you want. Just click the OK button.</p>
<h1 id="Step-7-Create-a-Multibranch-Pipeline-in-Jenkins"><a href="#Step-7-Create-a-Multibranch-Pipeline-in-Jenkins" class="headerlink" title="Step 7: Create a Multibranch Pipeline in Jenkins"></a>Step 7: Create a Multibranch Pipeline in Jenkins</h1><p>Select <em>New Item</em> on the left menu, enter a name for the Item, and select the <em>Multibranch Pipeline</em> type. This is a recommended type to maintain Jenkinsfile files in your own repository, making it easy to use different Jenkinsfile files in different branches in order to reach the point where you only need to create one Pipeline to support CI/CD processes for multiple environments at the same time. For example: Dev/Test/Prod/Hotfix, etc.<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T012945.png"></p>
<p>Select <em>Github</em> in <em>Branch Source</em><br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T013041.png"></p>
<p>Select the Credential you just created and fill in the address of your project on Github<br><img src="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/2021-08-10T013131.png"></p>
<p>After filling out the form, you can save it.</p>
<h1 id="Step-8-That’s-all-Now-you-can-test-it"><a href="#Step-8-That’s-all-Now-you-can-test-it" class="headerlink" title="Step 8: That’s all, Now you can test it"></a>Step 8: That’s all, Now you can test it</h1><p>You can modify the Repository on your Github and then push it to Github, refresh Jenkins later and you will see the results of Jenkins execution.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><ol>
<li>personal projects do not support the configuration of webhook, at least need to create an Organization.</li>
<li>if you are familiar with Jenkins, you can also configure other types of Pipeline, such as Freestyle Project and so on.</li>
<li>At present, Multibranch Pipeline needs to use https to access github by default, so you need to configure Personal access token on github.</li>
<li>You can also configure SSH type Credential with public-private key pair to access Github.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.futlabs.com/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/" data-id="cks7jeh980000y25v2fv2efrm" data-title="How to Integrate Github and Jenkins - Part I" class="article-share-link">Share</a>
      
        <a href="https://www.futlabs.com/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/#disqus_thread" class="article-comment-link">Comments</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkinsfile/" rel="tag">Jenkinsfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH-Agent/" rel="tag">SSH Agent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-diff/" rel="tag">git diff</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipeline/" rel="tag">pipeline</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/DevOps/" style="font-size: 20px;">DevOps</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Github/" style="font-size: 20px;">Github</a> <a href="/tags/Jenkins/" style="font-size: 20px;">Jenkins</a> <a href="/tags/Jenkinsfile/" style="font-size: 10px;">Jenkinsfile</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SSH-Agent/" style="font-size: 10px;">SSH Agent</a> <a href="/tags/git-diff/" style="font-size: 10px;">git diff</a> <a href="/tags/pipeline/" style="font-size: 10px;">pipeline</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/08/12/How-to-Integrate-Github-and-Jenkins-Part-II/">How to Integrate Github and Jenkins - Part II</a>
          </li>
        
          <li>
            <a href="/2021/08/09/How-to-Integrate-Github-and-Jenkins-Part-I/">How to Integrate Github and Jenkins - Part I</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Kenny Lee<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'futlabs';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>